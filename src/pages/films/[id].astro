---
import LinkPersonne from "@components/LinkPersonne.astro";
import Layout from "@layouts/Layout.astro";
import { data } from "alpinejs";
import { getEntries } from "astro:content";
import { getEntry } from "astro:content";
import { getCollection, render } from "astro:content";
import { formatDate } from "src/helpers";
// 1. Generate a new path for every collection entry
export async function getStaticPaths() {
  const films = await getCollection("films");
  return films.map((film) => ({
    params: { id: film.id },
    props: { film },
  }));
}

// 2. For your template, you can get the entry directly from the prop
const { film } = Astro.props;
const { Content } = await render(film);

// const profession = film.data.profession && [...new Set(film.data.profession)],

const realisateur =
  film.data.réalisateur && (await getEntry(film.data.réalisateur));
const scenariste =
  film.data.scénariste && (await getEntries(film.data.scénariste));

const roles =
  film.data.roles &&
  (await Promise.all(
    film.data.roles.map(async (r) => ({
      role: r.role,
      acteur: await getEntry(r.acteur),
    }))
  ));
---

<Layout pageTitle={`Fiche du Film ${film.data.titre} `}>
  <h1 class="font-bold text-lg">{film.data.titre}</h1>
  <p>Date de sortie : {formatDate(film.data.dateSortie)}</p>
  <p>Durée : {film.data.duree}</p>
  <p>Langue : {film.data.langue}</p>
  <p>Synopsis : {film.data.synopsis}</p>
  {
    realisateur && (
      <p>
        Réalisé par : <LinkPersonne personne={realisateur}/>
      </p>
    )
  }
  {
    scenariste && (
      <p>
        Scénario de :{" "}
        {scenariste
          .map((s) => <LinkPersonne personne={s} />)
          .reduce((prev, curr) => [prev, ", ", curr])}
      </p>
    )
  }
{ roles.length && (  <>
  <h2>Acteurs</h2>
  <ul>
    {
      roles.map((r) => (
        <li>
          <strong>{r.role}</strong> : Joué par <LinkPersonne personne={r.acteur}/>
        </li>
      ))
    }
  </ul>
  </>)}
  <!-- <pre>
    {JSON.stringify(film, null, 2)}
  </pre> -->
  <div class="prose prose-lg">
    <Content />
  </div>
</Layout>
